.TH LAZYKUBE-CONFIGURATION 7 "December 2025" "LazyKube 1.0" "LazyKube Manual"
.SH NAME
lazykube-configuration \- Configuration file formats for LazyKube
.SH DESCRIPTION
This manual page describes the configuration files used by
.BR lazykube (1).
All user-specific configuration is stored in
.BR ~/.lazykube/ .
.SH CONFIGURATION FILES
.SS ~/.lazykube/cluster-config
Stores cluster credentials and basic settings. This file is sourced as a shell script.
.PP
.B Format:
.nf
MASTER1_IP="192.168.1.10"
MASTER1_USER="ubuntu"
MASTER1_PASSWORD="secret"
MASTER1_KEY="~/.ssh/id_rsa"

MASTER2_IP="192.168.1.11"
MASTER2_USER="ubuntu"
MASTER2_PASSWORD=""
MASTER2_KEY="~/.ssh/id_rsa"

MASTER3_IP="192.168.1.12"
MASTER3_USER="ubuntu"
MASTER3_PASSWORD=""
MASTER3_KEY="~/.ssh/id_rsa"

HAPROXY_IP="192.168.1.100"
HAPROXY_USER="ubuntu"
HAPROXY_PASSWORD=""
HAPROXY_KEY="~/.ssh/id_rsa"

DOMAIN="k3cluster.local"
TIMEZONE="Europe/Rome"
.fi
.PP
.B Notes:
.IP \(bu 2
This file contains sensitive credentials
.IP \(bu 2
Should never be committed to git
.IP \(bu 2
Generated by
.B lazykube configure
.IP \(bu 2
Either PASSWORD or KEY should be set for each VM
.SS ~/.lazykube/inventory/hosts.yml
Ansible inventory file defining all hosts and their properties.
.PP
.B Format:
.nf
---
all:
  vars:
    ansible_python_interpreter: /usr/bin/python3
    domain: "k3cluster.local"
    timezone: "Europe/Rome"

  children:
    k3s_cluster:
      children:
        k3s_masters:
          hosts:
            master1:
              ansible_host: 192.168.1.10
              ansible_user: ubuntu
              ansible_ssh_private_key_file: ~/.ssh/id_rsa
              k3s_node_name: k3s-master1
              is_first_master: true

            master2:
              ansible_host: 192.168.1.11
              ansible_user: ubuntu
              ansible_ssh_private_key_file: ~/.ssh/id_rsa
              k3s_node_name: k3s-master2
              is_first_master: false

            master3:
              ansible_host: 192.168.1.12
              ansible_user: ubuntu
              ansible_ssh_private_key_file: ~/.ssh/id_rsa
              k3s_node_name: k3s-master3
              is_first_master: false

    haproxy:
      hosts:
        haproxy1:
          ansible_host: 192.168.1.100
          ansible_user: ubuntu
          ansible_ssh_private_key_file: ~/.ssh/id_rsa
.fi
.PP
.B Variables:
.TP
.B ansible_host
IP address of the VM
.TP
.B ansible_user
SSH username
.TP
.B ansible_ssh_private_key_file
Path to SSH private key (alternative to password)
.TP
.B ansible_ssh_pass
SSH password (alternative to key, not recommended)
.TP
.B k3s_node_name
Kubernetes node name for the master
.TP
.B is_first_master
Boolean flag indicating the first master (for initial cluster setup)
.SS ~/.lazykube/group_vars/all.yml
Cluster-wide Ansible variables and settings.
.PP
.B Format:
.nf
---
# HAProxy IP - Dedicated load balancer
haproxy_ip: "192.168.1.100"

# K3s configuration
k3s_version: "latest"
k3s_api_port: 6443
k3s_config_dir: "/etc/rancher/k3s"
k3s_data_dir: "/var/lib/rancher/k3s"

# Master nodes IPs for TLS SAN
master_ips:
  - "192.168.1.10"
  - "192.168.1.11"
  - "192.168.1.12"
  - "192.168.1.100"  # Include HAProxy IP

# Cluster domain
domain: "k3cluster.local"
cluster_name: "k3s-local"

# MetalLB configuration
metallb_version: "v0.15.2"
metallb_ip_range: "192.168.1.200-192.168.1.250"
traefik_loadbalancer_ip: "192.168.1.200"

# Traefik configuration
traefik_namespace: "traefik"
traefik_chart_version: "latest"
traefik_http_nodeport: 32080
traefik_https_nodeport: 32443

# cert-manager configuration
cert_manager_version: "v1.16.2"
use_self_signed_certs: true

# CoreDNS custom domain resolution
coredns_custom_domain: "{{ domain }}"
coredns_custom_ip: "{{ haproxy_ip }}"

# Kubeconfig local path
local_kubeconfig_path: "~/.kube/{{ domain }}-config.yml"

# HAProxy stats
haproxy_stats_port: 8404
haproxy_stats_user: "admin"
haproxy_stats_password: "admin"

# Monitoring (optional)
prometheus_version: "latest"
grafana_admin_password: "admin"
prometheus_retention_days: 7
prometheus_storage_size: "10Gi"
grafana_storage_size: "5Gi"
alertmanager_storage_size: "2Gi"
.fi
.PP
.B Key Variables:
.TP
.B haproxy_ip
IP address of the HAProxy load balancer
.TP
.B k3s_version
K3s version to install ("latest" or specific version like "v1.28.4+k3s1")
.TP
.B master_ips
List of master node IPs (must include HAProxy IP for TLS SAN)
.TP
.B domain
Cluster domain name (e.g., "k3cluster.local")
.TP
.B metallb_ip_range
IP address range for MetalLB LoadBalancer pool
.TP
.B traefik_loadbalancer_ip
Specific IP for Traefik LoadBalancer service (must be within metallb_ip_range)
.TP
.B cert_manager_version
cert-manager version to install
.TP
.B use_self_signed_certs
Use self-signed certificates (true for local clusters)
.SH TEMPLATES
.SS /usr/local/share/lazykube/templates/hosts.yml.template
Template for generating the Ansible inventory. Used by
.B lazykube configure
to create ~/.lazykube/inventory/hosts.yml.
.SS /usr/local/share/lazykube/templates/all.yml.template
Template for cluster variables. Copied to ~/.lazykube/group_vars/all.yml during initial configuration.
.SH SECURITY CONSIDERATIONS
.SS Credentials Storage
.IP \(bu 2
.B ~/.lazykube/cluster-config
contains plaintext passwords
.IP \(bu 2
File permissions should be 600 (read/write for owner only)
.IP \(bu 2
Never commit this file to version control
.IP \(bu 2
Prefer SSH keys over passwords
.SS SSH Keys
.IP \(bu 2
Recommended over password authentication
.IP \(bu 2
Should be protected with a passphrase
.IP \(bu 2
Private key permissions should be 600
.IP \(bu 2
Use ssh-agent to avoid entering passphrase repeatedly
.SS HAProxy Stats
.IP \(bu 2
Default credentials are admin/admin
.IP \(bu 2
Change haproxy_stats_password in ~/.lazykube/group_vars/all.yml
.IP \(bu 2
Stats page accessible at http://<HAPROXY_IP>:8404/stats
.SS Grafana
.IP \(bu 2
Default admin password is "admin"
.IP \(bu 2
Change grafana_admin_password in ~/.lazykube/group_vars/all.yml
.IP \(bu 2
Should be changed on first login
.SH CUSTOMIZATION
.SS Changing Cluster Domain
.IP 1. 3
Edit ~/.lazykube/group_vars/all.yml:
.nf
domain: "mycluster.local"
.fi
.IP 2. 3
Reinstall cluster:
.nf
lazykube uninstall
lazykube install
.fi
.SS Changing MetalLB IP Range
.IP 1. 3
Edit ~/.lazykube/group_vars/all.yml:
.nf
metallb_ip_range: "192.168.1.200-192.168.1.250"
traefik_loadbalancer_ip: "192.168.1.200"
.fi
.IP 2. 3
Ensure IPs don't conflict with DHCP
.IP 3. 3
Reinstall cluster or update MetalLB configuration
.SS Adding More Masters
LazyKube currently supports 3 masters. To add more:
.IP 1. 3
Update ~/.lazykube/inventory/hosts.yml with new master hosts
.IP 2. 3
Update ~/.lazykube/group_vars/all.yml master_ips list
.IP 3. 3
Run installation playbook
.PP
Note: etcd requires an odd number of nodes for quorum.
.SH BACKUP
.B Important files to backup:
.IP \(bu 2
~/.lazykube/cluster-config (credentials)
.IP \(bu 2
~/.lazykube/inventory/hosts.yml (host inventory)
.IP \(bu 2
~/.lazykube/group_vars/all.yml (cluster settings)
.IP \(bu 2
~/.kube/<domain>-config.yml (kubeconfig)
.IP \(bu 2
~/.kube/k3s-local-ca.crt (CA certificate)
.PP
.B Backup command:
.nf
tar czf lazykube-backup-$(date +%Y%m%d).tar.gz \\
    ~/.lazykube \\
    ~/.kube/*-config.yml \\
    ~/.kube/k3s-local-ca.crt
.fi
.SH EXAMPLES
.SS Minimal Configuration
For a simple test cluster:
.nf
# Edit ~/.lazykube/group_vars/all.yml
k3s_version: "latest"
domain: "test.local"
metallb_ip_range: "192.168.1.200-192.168.1.210"
use_self_signed_certs: true
.fi
.SS Production-Like Configuration
For a more robust setup:
.nf
# Edit ~/.lazykube/group_vars/all.yml
k3s_version: "v1.28.4+k3s1"  # Specific stable version
domain: "k3s.prod.local"
metallb_ip_range: "10.0.100.200-10.0.100.250"
haproxy_stats_password: "change-this-password"
grafana_admin_password: "change-this-password"
prometheus_retention_days: 30
prometheus_storage_size: "100Gi"
.fi
.SH SEE ALSO
.BR lazykube (1),
.BR lazykube-architecture (7),
.BR lazykube-troubleshooting (7),
.BR ansible (1),
.BR ansible-inventory (1)
